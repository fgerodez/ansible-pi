- hosts: pi
  vars:
    userns_root_uid: 165536
    nextcloud_network: nextcloud
    nextcloud_container: nextcloud
  vars_files:
    - ./external_vars.yml
  roles:
    - role: system
    
    - role: docker
      
    - role: nextcloud
      vars:
        nextcloud_uid: 82
        nextcloud_gid: 82
        nextcloud_container_name: "{{ nextcloud_container }}"
        nextcloud_bridge_name: "{{ nextcloud_network }}"
        nextcloud_vol_base: /docker/nextcloud
        mariadb_uid: 999
        mariadb_gid: 999
        mariadb_root_password: "{{ db_root_password }}"
        mariadb_vol_base: /docker/mariadb

    - role: mail
      vars:
        mail_bridge_name: mail
        mail_hostname: "{{ mail_server_hostname }}"
        mail_vol_base: /docker/mail
        dhparam_size: 4096
        postfix_container_name: postfix
        opendkim_container_name: opendkim
        opendkim_uid: 100
        opendkim_gid: 100
        dovecot_container_name: dovecot
        dovecot_vmail_uid: 5000
        dovecot_vmail_gid: 5000
        
    - role: reverse-proxy
      vars:
        proxy_uid: 1000
        proxy_gid: 1000
        proxy_volumes:
          - /docker/nextcloud/src:/nextcloud
        proxy_networks:
          - name: "{{ nextcloud_network }}"
        proxy_env:
          CLOUD_HOSTNAME: "{{ cloud_hostname }}"
          CLOUD_ROOT: /nextcloud
          CLOUD_FPM: "{{ nextcloud_container }}:9000"
          CLOUD_FCGI_ROOT: /var/www/html

